<!-- CoopID - TP4I2TR3 -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Coop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootswatch@4.5.2/dist/lux/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-dark">
    <div class="d-flex col-12 justify-content-center align-items-center min-vh-100">
        <div class="card col-12 col-md-5 col-lg-4" id="divLogin">
            <div class="card-header">
                <h3>Login</h3>
            </div>
            <div class="card-body">
                <form>
                    <div class="form-group mt-4">
                        <label for="txtLoginEmail" class="form-label">Email</label>
                        <input type="email" class="form-control" id="txtLoginEmail" placeholder="johndoe3@gmail.com">
                    </div>
                    <div class="form-group">
                        <label for="txtLoginPassword" class="form-label">Password</label>
                        <input type="password" class="form-control" id="txtLoginPassword" placeholder="********">
                    </div>
                    <button id="btnLogin" class="btn btn-success col-12 mt-4" type="button">Login</button>
                    <div class="col-12 d-flex justify-content-center">
                        <a class="col-12 text-center btnToggle" data-card="Login">Need an Account? Register Here</a>
                    </div>
                </form>
            </div>
        </div>
        <div class="card col-12 col-md-5 col-lg-4" id="divRegister" style="display:none;">
            <div class="card-header">
                <h3>Registration</h3>
            </div>
            <div class="card-body">
                <form>
                    <div class="form-group mt-4">
                        <label for="txtEmail" class="form-label">Email</label>
                        <input id="txtEmail" class="form-control" type="email" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtPassword" class="form-label">Password</label>
                        <input id="txtPassword" class="form-control" type="password" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtFirstName" class="form-label">First Name</label>
                        <input id="txtFirstName" class="form-control" type="text" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtLastName" class="form-label">Last Name</label>
                        <input id="txtLastName" class="form-control" type="text" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtStreetAddress1" class="form-label">Street Address 1</label>
                        <input id="txtStreetAddress1" placeholder="Street Address 1" type="text" class="form-control" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtStreetAddress2" class="form-label">Street Address 2</label>
                        <input id="txtStreetAddress2" placeholder="Street Address 2" type="text" class="form-control" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtCity" class="form-label">City</label>
                        <input id="txtCity" placeholder="City" type="text" class="form-control" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtState" class="form-label">State</label>
                        <input id="txtState" placeholder="State" type="text" class="form-control" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtZip" class="form-label">Zip</label>
                        <input id="txtZip" placeholder="Zip" type="text" class="form-control" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="telPhoneNum" class="form-label">Phone Number</label>
                        <input id="telPhoneNum" placeholder="E.g, 111-222-3333" type="tel" class="form-control" aria-required="true">
                    </div>
                    <div class="form-group">
                        <label for="txtCoopID" class="form-label">CoopID</label>
                        <input id="txtCoopID" placeholder="Coop ID" type="text" class="form-control" aria-required="true">
                    </div>
                    
                    <button class="col-12 btn btn-success mt-4" id="btnRegister" type="button">Register</button>
                    <button id="btnReset" type="button" class="btn btn-tertiary col-12 mt-1">Reset Form</button>
                    <div class="col-12 d-flex justify-content-center">
                        <a class="col-12 text-center btnToggle" data-card="Register">Return To Login</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>

        // $.post('https://simplecoop.swollenhippo.com/coop.php', function(result){
        //             result = JSON.parse(result)
        //             // console.log(result)
        // })

        $.get('https://www.thesimplehomestead.com/simpletime/sessions.php',{SessionID:sessionStorage.getItem('SimpleSession')},function(result){
            result = JSON.parse(result)
            if(result != null){

            }
            else if(result.Email){

            }
        })

        $('.btnToggle').on('click',function(){
            let strCard = $(this).attr('data-card');
            if(strCard == 'Login'){
                $('#divLogin').slideToggle(function(){
                    $('#divRegister').slideToggle();
            })
            } else {
                $('#divRegister').slideToggle(function(){
                    $('#divLogin').slideToggle();
                })
            }
        })

        $('#btnReset').on('click', function(){
            $('#txtFirstName').val('');
            $('#txtLastName').val('');
            $('#txtEmail').val('');
            $('#txtPassword').val('');
            $('#txtStreetAddress1').val('');
            $('#txtStreetAddress2').val('');
            $('#txtCity').val('');
            $('#txtState').val('');
            $('#txtZip').val('');
            $('#telPhoneNum').val('');
            $('#txtCoopID').val('');
        })

        $('#btnLogin').on("click", function () {
            let strEmail = $('#txtLoginEmail').val().trim();
            let strPassword = $('#txtLoginPassword').val().trim();
            let regexEmail = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/g
            let regexPassword = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$/g
            blnError = false
            htmlError = ''

            if (!strEmail.match(regexEmail)){
                blnError = true
                htmlError += "<p>Email is invalid<p>"
            } 
            if (!strPassword.match(regexPassword)){
                blnError = true
                htmlError += '<p>Password must contain 8 characters, 1 uppercase, 1 lowercase, and 1 number.</p>'
            }

            if(blnError){
                Swal.fire({
                    title: "Oops!",
                    html: htmlError,
                    icon: "error"
                });
            }

            else {
                $("#divLogin").slideToggle();
                $.post('https://www.thesimplehomestead.com/simpletime/sessions.php',{Email:strEmail,Password:strPassword},function(result){
                    result = JSON.parse(result)
                    sessionStorage.setItem("SessionID",result.SessionID)
                })
            }
        });

        

        $('#btnRegister').on('click',function(){
            let blnError = false;
            let strError = '';
            let regexEmail = /[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/g
            let regexPassword = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[a-zA-Z]).{8,}$/g

            let strFirstName = $('#txtFirstName').val().trim();
            let strLastName = $('#txtLastName').val().trim();
            let strEmail = $('#txtEmail').val().trim();
            let strPassword = $('#txtPassword').val().trim();
            let strStreetAddress1 = $('#txtStreetAddress1').val().trim();
            let strStreetAddress2 = $('#txtStreetAddress2').val().trim();
            let strCity = $('#txtCity').val().trim();
            let strState = $('#txtState').val().trim();
            let strZip = $('#txtZip').val().trim();
            let intPhoneNum = $('#telPhoneNum').val().trim();
            let strCoopID = $('#txtCoopID').val().trim();

            if(strFirstName.length <1){
                blnError = true;
                strError += '<p>First name cannot be blank.</p>'
            }
            if(strLastName.length <1){
                blnError = true;
                strError += '<p>Last name cannot be blank.</p>'
            }
            if(!regexEmail.match(strEmail)){
                blnError = true
                strError += '<p>Email is not valid.<p>'
            }
            if(!regexPassword.match(strPassword)){
                blnError = true;
                strError += '<p>Password must contain 8 characters, 1 uppercase, 1 lowercase, and 1 number.</p>'
            }
            if(strStreetAddress1.length <1){
                blnError = true;
                strError += '<p>Street Address 1 cannot be blank.</p>'
            }
            if(strStreetAddress2.length <1){
                blnError = true;
                strError += '<p>Street Address 2 cannot be blank.</p>'
            }
            if(strCity.length <1){
                blnError = true;
                strError += '<p>City cannot be blank.</p>'
            }
            if(strState.length <1){
                blnError = true;
                strError += '<p>State cannot be blank.</p>'
            }
            if(strZip.length < 5 || strZip.length > 5){
                blnError = true;
                strError += '<p>Zip code cannot be blank.</p>'
            }
            if(intPhoneNum.length <1){
                blnError = true;
                strError += '<p>Phone number cannot be blank.</p>'
            }
            if(strCoopID.length <1){
                blnError = true;
                strError += '<p>Invalid CoopID.</p>'
            }

            if(blnError == true){
                Swal.fire({
                    title: "Oops!",
                    html: strError,
                    icon: "error"
                });
            } else {
                $("#divRegister").slideUp()
                $.post('https://simplecoop.swollenhippo.com/users.php', {Email:strEmail,Password:strPassword,FirstName:strFirstName,LastName:strLastName,CoopID:strCoopID},function(result){
                    result = JSON.parse(result)
                    if(result.Error){
                        Swal.fire({
                            title: "Oops!",
                            html: '<p>' + result.Error + '</p>',
                            icon: "error"
                        });
                    }
                    console.log(result)
                })
                $.post('https://simplecoop.swollenhippo.com/useraddress.php', {Email:strEmail,Street1:strStreetAddress1,Street2:strStreetAddress2,City:strCity,State:strState,ZIP:strZip},function(result){
                    result = JSON.parse(result)
                    if(result.Error){
                        Swal.fire({
                            title: "Oops!",
                            html: '<p>' + result.Error + '</p>',
                            icon: "error"
                        });
                    }
                    console.log(result)
                })
            }
        })
    </script>
</body>
</html>